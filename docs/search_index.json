[["index.html", "LaBaratory Wiki Overview", " LaBaratory Wiki Nathan Muncy Overview This site is under construction (Jul 26, 2022). This digital book contains resources and learning materials compiled for the LaBaratory of emotion and cognition. Content is organized in the following chapters: Chapter 1, Getting Started Chapter 2, Accessing Servers Chapter 3, Psychophysics Chapter 4, Psychtoolbox "],["getting-started.html", "Chapter 1 Getting Started 1.1 Location 1.2 Duke Card 1.3 Computer Access 1.4 Human Research Training", " Chapter 1 Getting Started Created on 2019 Jun 05 by Gregory Steward. Ported to bookdown on 2022 Jul 26 by Nathan Muncy. 1.1 Location The CCN is located in the Levine Science Research Center on Research Dr. in Duke’s West campus. It is named after Leon Levine, a NC native that is the founder of the Family Dollar retail stores. The building is a multidisciplinary research center, including computer sciences, environmental sciences, and pharmacology. The building has 4 sections, designated A, B, C, and D wings. Individual rooms are named with the wing prefix followed by 3 digits, the first indicates the floor. For example, the Kevin’s office is located in B247 (B wing and 2nd floor). Doors into the building are unlocked during normal weekday business hours, however they lock in the evening, during weekends, and during holidays. You can enter the building when the doors are locked by using your Duke ID in the external door card swipe on either side of the B wing lobby. The lab is located in B104. The lab is accessed by a door in the main lobby of the building. This door is accessible via Duke ID card swipe or a lab key. There are three testing rooms in the lab. The first is the Main testing room, which includes the Biopac MP160 psychophysiology testing system. The second is Room 2 Behavioral 2 (R2B2), which is the small testing room that can only collect behavioral data. The final testing room, 3rd - Psychophysiology Office (3PO), will contain an MP150 psychophysiology testing setup when the room gets completed. 1.2 Duke Card All students and employees must have a DukeCard, the official ID card for the university. There are 2 types of ID cards, a standard card (Magnetic stripe) and one with an embedded HID chip (Proximity card). All lab members should have cards with a HID chip, security doors at the hospital use these chips to determine security clearance. If you do not have a card or need a replacement, the office is located in the rear of the Telcom Building and there is an exterior door that leads into the office. The office is open M-F from 8am – 6pm. A government issued ID card (e.g., driver’s license, passport, etc.) is required to obtain a DukeCard. The lab will pay for the first card via an IR form, which has to be approved by the department HR representative. Replacement cards (lost/stolen) cost $15. You can also use your DukeCard as a pre-paid debit card through the Flexible Spending Account (FLEX). The FLEX account is automatically created when the DukeCard is issued. There is no minimum deposit to open an account. You can deposit funds into your account online. Employees can also set up an automatic deduction from your pay by going to the Duke@Work My Pay tab. The funds can be used at most places on campus, but you cannot use the account to withdraw cash. If you are a non-Duke student or visiting scholar, the process is similar to the above, but you will also have to get a sponsored Duke account from the LaBar lab manager before beginning the process. 1.3 Computer Access Keoki is the name of our data storage server. The primary folder we use in the lab is experiments2, which contains data from recently completed experiments, current experiments, lab member folders, administrative documents, and website attributes. To get on the whitelist to access Keoki, please see the LaBar lab manager. Once whitelisted, the path to map keoki/experiments2 to your computer is :\\\\ccn-keoki.win.duke.edu\\experiments2 for PC or smb://ccn-keoki.wim.duke.edu/experiments2 for Mac. 1.4 Human Research Training Information outlined below pertains to trainings that must be completed by all key personal part of a DUHS IRB protocol (for a research study are research personnel who are directly involved in conducting the research with human subjects through an interaction or intervention for research purposes, including participating in the consent process by either leading it or contributing to it; OR who are directly involved with recording or processing identifiable private information, including protected health information, related to those subjects for the purpose of conducting the research study): Collaborative Training Initiative (CITI) modules for graduate students and staff: Navigate to www.citiprogram.org Log in via SSO with your Duke NetID and password Choose “Duke Health” Complete required modules: Biomedical Research – Basic/Refresher New individuals are required to take nine modules (automatically populates once appropriate registration is complete). Individuals who have already completed the training will be required to renew their credentials every three years with refresher modules. CITI will send you an automated email 90 days prior to expiration. Undergraduates: Navigate to www.citiprogram.org Log in via SSO with your Duke NetID and password Choose “Duke University Campus IRB” Complete required modules: History and Ethical Principles If an undergraduate is going to be working on a Medical school IRB, they will have to complete the CITI training for grad students/ staff. In addition to CITI, undergraduates who will be involved in the consenting process must also complete Informed Consent Process training specifically for undergraduates. Please note that other conditions and restrictions apply, depending on which department the IRB is housed under; for more information please see the Undergraduates Engaged in Consent Policy. "],["access-server.html", "Chapter 2 Accessing Servers 2.1 LaBar Lab Shared Drive (keoki) 2.2 BIAC Servers", " Chapter 2 Accessing Servers Created on 2020 Aug 25 by Gregory Steward. Ported to bookdown on 2022 Jul 26 by Nathan Muncy. 2.1 LaBar Lab Shared Drive (keoki) Request LaBar lab whitelist permissions from the lab manager (can sometimes take 24 hours for the update to push through). Map the network drive For Windows, go to My computer or This PC and map network drive. Choose a drive and enter \\\\ccn-keoki.win.duke.edu\\experiments2\\ to access the lab’s shared drive. Keep in mind that this is mapped to the specific PC you are using, so will need to remap it to other computers as needed. For Mac OSx, open Finder and select go. Select connect to server and enter smb://ccn-keoki.win.duke.edu/experiments2/ to access the lab’s shared drive. Keep in mind that this is mapped to the specific PC you are using, so will need to remap it to other computers as needed. 2.2 BIAC Servers This document contains information on installing and setting up the local software necessary to log into and transfer files to/from the BIAC servers. This is required in order to access any imaging data collected at BIAC. Remotely logging into the BIAC servers will also allow you to run scripts on the servers and use the various image analysis software packages installed there. NOTE 1: BIAC recently (11/2015) began requiring Duke’s multi-factor authentication system in order to log into their servers. If you have not set this up already, see this web page for details. NOTE 2: You will need a DHE account to fully log into the BIAC servers. 2.2.1 Mac OSx Users Mac OSX comes with the software necessary to log into and transfer files from the BIAC servers; no additional installation is required. 2.2.1.1 Logging into the BIAC Servers Open a Terminal window. The Terminal application can be found in …/Applications/Utilities. Type ssh -o ServerAliveInterval=120 -o TCPKeepAlive=no -X &lt;username&gt;@hugin.biac.duke.edu (replacing “username” with your actual user name) into the Terminal window. After typing in your password when prompted and completing multi-factor authentication you will be logged into the BIAC servers. If you are presented with an “are you sure you want to connect” question, just type “yes”. 2.2.1.2 Copying Files from the BIAC Servers Open a Terminal window. The Terminal application can be found in …/Applications/Utilities. Use the scp command to copy files between the BIAC servers and your local computer. 2.2.1.3 Examples Copy from BIAC to local: scp &lt;username&gt;@hugin.biac.duke.edu:/path/to/file /localpath/ Copy from local to BIAC: scp &lt;-r&gt; /localpath/ &lt;username&gt;@hugin.biac.duke.edu:/path/to/file In the examples above, replace “username” with your user name, “path” with the full path to the desired directory on the BIAC server, “file” with the name of the file (including 3-character file extension), and “localpath” with the full path to the desired local directory. Note that the scp command has options for copying multiple files at once, for more info on scp, see here. 2.2.2 Windows Users Two additional programs will need to be installed, one that handles logging into the BIAC servers and another that handles file transfer. 2.2.2.1 Logging into the BIAC Servers Download and install X-Win32. This can be done via Duke’s OIT site (Browse and Order Software). Set up X-Win32 to get to the BIAC servers. Follow the instructions here. Once X-Win is set up, select the hugin connection (or whatever you named it) and click “Launch”. Enter your password/multi-factor authenticate when prompted and you should end up with a BIAC server terminal window. If you receive an “are you sure you want to connect” question, just type “yes.” 2.2.2.2 Copying Files from the BIAC Servers Download and install WinSCP. This can be done from Duke’s OIT site (Browse and Order Software). Set up WinSCP to get to the BIAC servers. Create a new “Site” in WinSCP (this can be called whatever you want, but “BIAC” is a good suggestion) with the following values: File Protocol: SFTP Host name: nernst.biac.duke.edu Port number: 22 User Name: (your user name) Once the new site is created, highlight it and click “Login”. After password/authentication prompts this should provide a graphical interface for transferring files, very similar in appearance and function to Windows Explorer. 2.2.3 After Succesful Login The BIAC servers run linux. You’ll need to type linux commands at the command prompt in order to do anything. An introduction to this environment can be found here. The BIAC servers also have a variety of image analysis software packages installed. In order to use any of them, you’ll need to enter “interactive” mode by simply typing “qinteract” into the command line. This may prompt another password/authentication request. The list of installed software can be found here. "],["psychophys.html", "Chapter 3 Psychophysics 3.1 Psychophysics - ECG 3.2 Psychophysics - EDA 3.3 Psychophysics - EGG 3.4 Psychophysics - EMG 3.5 Psychophysics - RSP 3.6 Psychophysics - STIM", " Chapter 3 Psychophysics 3.1 Psychophysics - ECG Created on 2019 Jun 05 by Gregory Steward. Ported to bookdown on 2022 Jul 27 by Nathan Muncy. 3.1.1 Introduction An electrocardiogram (ECG) is a recording of the electrical activity of the heart using electrodes placed on the skin. These electrodes detect the small electrical changes that are a consequence of cardiac muscle depolarization followed by repolarization during each cardiac cycle (heartbeat)\\(^1\\). Our lab uses a 3 lead setup, where electrodes will be placed at 3 points on the body. Specifically, we follow a lead II configuration (see the diagram below). The lead II configuration consists of having the negative lead attached to the right wrist, the positive lead attached to the left ankle, and a grounded lead attached to the right ankle. We prefer to use this configuration as the electrode placements interfere the least with other psychophysiology measure electrode placements. You can run using other configurations, but keep in mind the possible interference from other electrodes. 3.1.2 Supplies 3 x EL203 disposable electrodes LEAD110 LEAD110S-R (the shielded red lead) LEAD110S-W (the shielded white lead) Paper towel Nuprep 3 x Q-Tips Cotton wipe/ cotton round/ tissue Gel 100 3.1.3 Computer Preparation Log into psychophysiology computer. Turn on BIOPAC system. Open Acknowledge (5.0 for MP160 system, 4.1 for MP150 system). Load experimental file template. Check that the input is Channel 4 (analog). Check where the data is being saved. 3.1.4 Lead Preparation Take the red lead and attach it to the ECG cable in the testing room by attaching the red insert into the Vin\\(+\\) slot and the black insert into the top shield slot. Repeat with the white lead by attaching the white insert into the Vin\\(-\\) slot and the black insert into the bottom shield slot. Insert the black lead with the CBL205 attachment into the GND slot on the ECG cable. 3.1.5 Electrode Preparation and Placement Have the subject wash their hands/wrists with non-moisturizing and dye-free soap then dry with a paper towel (if there is no soap following the specifications, have the participant rinse with just water). Prepare the q-tips with a drop of Nuprep each. Instruct the participant to scrub an area of the lower right wrist/ upper right forearm (see below) with a prepped q-tip (make sure the location is slightly offset to the left of the arm mid-line). Repeat step 3 with the remaining q-tips for the areas behind the participant’s ankles (see below, which is not directly on the ankle, but behind the ankle before the Achilles tendon slightly below the ankle mid-line). Have the participant clean off the Nuprep with a water wet cotton round or tissue. Have participant dry applied areas with another cotton round or tissue. While subject is drying, apply a “pea sized” drop of Gel 100 to the underside of one of the disposable electrodes. Apply the gelled electrode to one of the three sites. Repeat steps 7 and 8 for the two remaining sites. 3.1.6 Lead Application and Clean Up Unlike other psychophysiology measures in the lab, it is absolutely critical to attach and remove the leads to the participant in the correct order! Take black ground lead and attach it to the subject’s right ankle electrode. Take the white lead and attach it to the subject’s right arm electrode. Take the red lead and attach it to the subject’s left ankle electrode. Run the experiment. When finished, remove the leads in the inverse order you applied them (Red lead, white lead, black lead). Have the subjects peel off the electrodes and dispose of them in the trash. Offer the subject a wet paper towel or alcohol wipe to clean up any excess electrode gel that may be on them. Hang all three leads back onto the ECG hook in the testing room. 3.1.7 References Electrocardiography. (2022, Jul 27). In Wikipedia. https://en.wikipedia.org/wiki/Electrocardiography 3.2 Psychophysics - EDA Created on 2019 Jun 05 by Gregory Steward. Ported to bookdown on 2022 Jul 28 by Nathan Muncy. 3.2.1 Introduction Electrodermal activity (EDA) is the property of the human body that causes continuous variation in the electrical characteristics of the skin. Historically, EDA has been known as galvanic skin response or GSR (the MP150 has a module that is still labelled as GSR. It is believed that skin resistance varies with the state of sweat glands in the skin. Sweating is controlled by the sympathetic nervous system, and skin conductance is an indication of psychological or physiological arousal. If the sympathetic branch of the autonomic nervous system is highly aroused, then sweat gland activity also increases, which in turn increases skin conductance. In this way, skin conductance can be a measure of emotional and sympathetic responses\\(^1\\). Our lab in particular looks at EDA in the palm of the hand, as it allows for subjects to use their fingers to enter computer responses to stimuli, without affecting the data. 3.2.2 Procedures The following outlines the standard procedure for collecting skin conductance data in our lab. Note: Place the electrodes a minimum of 5 minutes before recording, but aim for closer to 15 minutes. Have the subject gently wash their hands with soap and water. Use the specific soap provided by the lab for this purpose, whether in the lab or the BIAC. Moisturizers and anti-bacterial components of soap products can affect conductivity in the skin; these can be difficult to avoid for our purposes, but we can be consistent about our use. More importantly, the soap should not be abrasive (micro-scrubbing beads and such) as this damage to the skin tissue can change its composition and conductivity. Dry hands gently but completely before electrode placement. Use the disposable electrodes that come with gel already applied. Add a pea-sized drop of electrode gel on top of the gel in the electrode. We add fresh gel because the original gel dries over time and may not mix as well with the skin. Place the electrode firmly on the hypothenar eminence of the non-dominant palm at a perpendicular orientation to the eminence leaving space for two adjacent electrodes along the length of the eminence. Apply the second electrode. Apply tape if necessary to keep electrodes in place (for example, if the subject has excessively sweaty hands). While the distal phalanges may be a slightly more ideal site for recording in terms of eccrine sweat gland distribution, the size of the hypothenar eminence allows for easier and more secure electrode placement and allows for more use of the fingers on the recording hand. The subject may make responses with the fingers of the non-dominant hand as long as these responses do not occur during periods that will be analyzed for skin conductance. Further, the subject should be instructed to minimize any unnecessary movement of the recording hand since movement can introduce noise into the signal. Connect the wires to electrodes so they are not obstructive or uncomfortable. Begin acquisition with AcqKnowledge and check for proper signal. You can ask the subject to hold their breath briefly and then exhale to try to prompt a skin conductance response. If it seems likely the subject’s conductance will hit ceiling levels at some point, the gain switch on the front of the GSR BIOPAC module may be repositioned from 10 microsiemens/volt to 20 before beginning the task and the data rescaled in AcqKnowledge accordingly. This should rarely be necessary, but be sure to note this in the subject’s notes and replace the switch after the subject’s session is complete. AcqKnowledge note: We have been recording skin conductance at a frequency of 1 kHz in AcqKnowledge. 3.2.3 References Electrodermal activity. (2022, Jul 28). In Wikipedia. https://en.wikipedia.org/wiki/Electrodermal_activity 3.3 Psychophysics - EGG To be constructed (Jul 28, 2022). 3.4 Psychophysics - EMG Created on 2020 Feb 12 by Gregory Steward. Ported to bookdown on 2022 Jul 28 by Nathan Muncy. 3.4.1 Introduction An electromyogram (EMG) is a psychophysiology measure for evaluating and recording the electrical activity produced by skeletal muscles. An electromyograph detects the electric potential generated by muscle cells when these cells are electrically or neurologically activated. The LaBar lab most frequently studies Corrugator Facial EMG and Zygomaticus Facial EMG , which focuses on the coruggator supercili group of muscles above the eye and the zygomaticus major muscle along the cheek, respectively\\(^1\\). 3.4.2 Supplies 4 x EL254S reusable shielded electrodes 1 x EL254 reusable un-shielded electrode 5 x ADD204 Stickers Biopac gel 100/ Signa Gel Non moisturizing alcohol wipe Nu-prep Q-tips Tissues Cotton swab/ cotton round 3.4.3 Computer Preparation Log into psychophysiology computer. Check that the BIOPAC EMG module is set to the following: 5000 gain 500 Hz low pass filter 100 Hz high pass filter turned off 10 Hz high pass filter Turn on BIOPAC system. Open Acknowledge (5.0 for MP160 system, 4.1 for MP150 system). Load experimental file template. Check that the sampling rate is 1000 kHz. Check that the input is Channel 2 (for EMG1) or 3 (for EMG2). Check where the data is being saved. 3.4.4 Face Preparation Clean face with an alcohol wipe. OPTIONAL - electrode face preparation can proceed just with the alcohol wipe) Apply the NuPrep (shown in the image above) with a Q-tip to the areas where the electrodes will be applied (see figure below for clarification on electrode placement sites). Apply mild pressure to scrub these areas with the Q-tip. Skin should be slightly red. This step helps to ensure that we are able to remove dead skin cells and have better conductance. If using NuPrep, make sure swabbed area is dry before applying electrodes. Clean the NuPrep off with a cotton round or tissue. Throw away all cotton pads, tissues, and Q-tips used during face prep. 3.4.5 Electrode Preparation Obtain 2 clean shielded EMG electrodes and 1 un-shielded EMG electrodes. The need for an un-shielded electrode is to establish a ground to help reduce noise. If you have a grounded lead already established with either ECG or EDA, you will not need to add this additional ground. Place the circle stickers on the lead so that the hole of the lead align, and so the tab of the sticker is the same direction of the wire as shown in the image below. (Optional for Corrugator) Cut off the top edge and the left edge of the sticker that hang over the edge of the lead for the shielded leads. Place signa gel into electrode well. Using a gel filled syringe, gently fill the well without touching the needle tip to the inside of the electrode. Make sure to fill it to the top of the well, but not too excessively. To get rid of any remaining air bubbles, use the packaging from the alcohol wipe or other rolled scrap of paper to stir the gel. 3.4.6 Electrode Placement - corrugator muscle Place first electrode so that it is in line with the inner corner of the subject’s right eye and just above the subject’s eyebrow. The electrode should be placed so that the wire sits perpendicular to the subject’s eyebrow. Place the second electrode to the left of the first electrode (to the subject’s right). The electrode should be placed so that the wire sits parallel to the subject’s eyebrow. If needed place the third un-shielded electrode in the middle of the forehead close to the hairline. Place the lead wires behind the subject’s right ear and tape them to their right shoulder while the subject looks to their left. This will allow the subject to move or turn without tugging the wires. For the shielded electrodes, plug the black wire (with the green shield marker) into the EMG plugs that say “shield”. Plug the white signal wires into the the ports that say “VIN+” or “VIN-”. Lastly, if you need a ground electrode, plug it into the center hole labelled “GND.” 3.4.7 Electrode Placement - zygomaticus muscle Have the subject smile to see if you can see the general area of the zygomaticus muscle. Place first shielded electrode so that is directly on the muscle, which should be about halfway from the middle of the subject’s ear to the corner of the subject’s mouth. Place the second shielded electrode adjacent to the first in the direction closer to the corner of the subject’s mouth. If needed place the third un-shielded electrode in the middle of the forehead close to the hairline and tuck the electrode lead wire behind the subject’s ear. Tape the electrodes to their right shoulder while the subject looks to their left. This will allow the subject to move or turn without tugging the wires. For the shielded electrodes, plug the black wire (with the green shield marker) into the EMG plugs that say “shield”. Plug the white signal wires into the the ports that say “VIN+” or “VIN-”. Lastly, if you need a ground electrode, plug it into the center hole labelled “GND.” 3.4.8 Cleaning When finished with the experiment, remove the stickers from the electrodes and dispose of them. Use the distilled water squeeze bottle by the sink to clean the gel completely out of the leads. If necessary, soak the electrode heads in a small cup of distilled water for 15 minutes and up to 1 hour and re-rinse with the squeeze bottle. Hang the leads on the rack opposite of the sink to dry completely before using again. Return all the gels, NuPrep, and stickers to their original locations. 3.4.9 References Electromyography. (2022, Jul 27). In Wikipedia. https://en.wikipedia.org/wiki/Electromyography 3.5 Psychophysics - RSP Created on 2020 Sep 04 by Gregory Steward. Ported to bookdown on 2022 Jul 29 by Nathan Muncy. 3.5.1 Introduction The Respiratory Effort Transducer measures changes in thoracic or abdominal circumference to assess respiratory effort. 3.5.2 Supplies Respiratory transducer belt. Loosen one or both ends of the velcro on the transducer and wrap it around the chest of the subject (or have the subject wrap it around themselves if it is more comfortable). Tighten the Respiratory Effort Transducer around the most expanded area of the subject’s abdomen during breathing (generally about 5 cm below the armpits), and tighten one or both straps until it fits snugly but is not uncomfortable. The sensor should be placed on the front of the chest. Plug the transducer cable into the MEC100C extension cable labelled RSP. If you have trouble getting a signal from the belt, try using one of the back up belts in the drawers of the testing room. 3.6 Psychophysics - STIM Created on 2019 Sep 16 by Gregory Steward. Ported to bookdown on 2022 Jul 29 by Nathan Muncy. 3.6.1 Supplies 2 x EL203 disposable electrodes 2 x LEAD110 Paper Towel Gel 100 3.6.2 Computer Preparation Log into psychophysiology computer. Turn on BIOPAC system. Turn on the stim box (Note: the stim box sends out a pulse on initializing, so make sure that the subject is not connected). Make sure the stimulation level is set at 0. Open Acknowledge (5.0 for MP160 system, 4.1 for MP150 system). Load experimental file template. Check that the input is Channel 4 (analog). Check where the data is being saved. (Optional) Open Presentation for the stim work-up, ignore if calibrating manually. 3.6.3 Electrode Preparation and Placement Have the subject wash their hands/wrists with non-moisturizing and dye-free soap then dry with a paper towel (if there is no soap following the specifications, have the participant rinse with just water). While subject is drying, apply a “pea sized” drop of Gel 100 to the underside of one of the disposable electrodes. Apply the gelled electrodes the left forearm in close proximity, but not overlapping. Take the two leads attached to the stim cable and connect to the recently placed electrodes. 3.6.4 Stim Calibration Because the tolerance for electrical stimulation can vary wildly by individual subject, we calibrate the voltage level of stimulation each subject receives in a process called “stim work-up.” There are two means of doing the stim work-up; digital and analog. The primary difference is the duration of the stimulation, where you can set the digital to any time length (6 ms usually), whereas the analog is at a fixed 15ms. 3.6.4.1 Digital calibration Open the stim work-up file for the Presentation software (make sure the stim box voltage level is set to 0, or that the subject is disconnected from the electrode leads). Set the voltage level to 10 volts on the stim box. Tell the subject that we are going to tailor their level of stimulation to a point that they find annoying, but not painful and that you will start with a low level starter pulse. Trigger the presentation software to send a pulse (it should be using port code 21). Ask the subject how they feel. Increase the voltage by 10 if the subject feels the level is weak. Repeat steps 4-6 until the subject starts to feel something stronger. Fine tune by increments of 2-5 volts until you find the level where the subject says the stimulation is annoying but not painful. 3.6.4.2 Analog calibration Set the voltage level to 10 volts on the stim box. Tell the subject that we are going to tailor their level of stimulation to a point that they find annoying, but not painful and that you will start with a low level starter pulse. Press the manual pulse button on the back of the stim box. Ask the subject how they feel. Increase the voltage by 10 if the subject feels the level is weak. Repeat steps 4-6 until the subject starts to feel something stronger. Fine tune by increments of 2-5 volts until you find the level where the subject says the stimulation is annoying but not painful. 3.6.5 Clean Up Set the stim box voltage to 0 volts. Turn off the stim box (if the stim box is left on overnight it will likely blow a fuse). Remove the leads from the subject and hang them back up on the stim hook. Instruct the subject to remove the electrodes from their arm and dispose of them. Offer the subjects a wet paper towel or show them the sink to clean excess gel left on their arm. "],["psychtoolbox.html", "Chapter 4 Psychtoolbox 4.1 Introduction 4.2 Questions and Answers 4.3 Screen Function 4.4 Psychtoolboox use at BIAC", " Chapter 4 Psychtoolbox Created by Gregory Steward, last edited on 2019 Jun 05 by Natasha Parikh. Ported to bookdown on 2022 Jul 29 by Nathan Muncy. 4.1 Introduction This wiki page will hopefully be a useful guide to the basics of Psychtoolbox (PTB). For specific questions, please take a look at our Psychtoolbox Q&amp;A section. If you are coming in with little or no MATLAB experience, it may be useful to get an overview of how the language works first, as this guide will assume basic MATLAB understanding. For a quick review of MATLAB and an introduction to PTB, it may be useful to look over the first few weeks of slides provided by Dr. Jonas Kaplan from USC: Intro to Psychtoolbox in Matlab. Below we outline a few basics for working with PTB scripts. Then, we recommend you use the example scripts and demos noted in the second section to see contextual examples of more specific functions. 4.1.1 Basics Screen Function. The Screen command is the basis of PTB scripts, as it controls the way information is displayed to the participant. Because of its fundamental nature, we decided to begin with a brief overview of its functionality so that you can get started on the framework of an experiment. Screen can have many different functions, and many functions work with Screen to create a working program. Before you can present things to the subject, you must first initialize a “window” that will contain the visual material you want to present. You create a new window with the Screen(‘OpenWindow’) function. A simple (but not perfect) way to think about this window is as a double-sided dry erase board. Each side of the board can be referred to as a buffer. At any given time, you present one side to the subject. This is the front buffer. While the subject views the material on the front buffer, you prepare the next screen you want them to see on the back buffer. For example, you can prepare text using the DrawFormattedText() function or images using the Screen(‘DrawTexture’) function. When you are ready to present the next screen, use the Screen(‘Flip’) function to flip the buffers: the back buffer switches to the front and you get a new back buffer to prepare for the next screen and so on. To end your program, you must close the window and anything drawn on it so that you can access your monitor again. To do this, you simply use Screen(‘CloseAll’). We provide a brief example with a detailed description of each function in the Screen Function section. Try-Catch Structure. We recommend using the try-catch structure for your PTB scripts to make them more robust to errors. The next section contains examples of this. The idea here is to embed the bulk of your script (the real “functional” portion) in the try block. MATLAB will attempt to execute everything in the try block per usual. If no errors occur, the catch block will be skipped entirely. If any errors do occur within the try block, MATLAB will immediately jump to the catch block and proceed through whatever commands you have included there to deal with the error situation. This way, an error is much less likely to crash your task in an especially unceremonious way (just freezing, leaving keyboard output disabled, etc.) or go unnoticed until after it is done. Rather, the catch block can be used to properly close files and restore settings as well as report info on the error. 4.1.2 Learn Through Examples One of the best ways to get started is to look through one or more existing PTB experiments and learn how they work. You can then use relevant parts from these as a model for your own PTB script. We are linking two previous, well-commented experiments from the lab below. We believe it’s easier to learn a lot of these functions in context. So, instead of going through all the common functions one by one, we commented these scripts to try to explain what the functions and their components are doing. Experiment 1 Code: Training Session, Main Task This experiment compares different emotion regulation techniques in response to aversive pictures. It involves cuing the subject for a viewing strategy, presenting an image, and presenting several screens asking the subject to make a keyboard response. The full set of files and scripts associated with this experiment can be found in ccn-keoki.win.duke.edu/experiments2/John/EmoReg1. These scripts cover: Using arguments (input you give your script when you call it, such as the subject #). Constructing and using pseudo-randomized stimuli and condition orders. Defining and presenting screens with text or images. Working with keyboard responses. Sending signals to BIOPAC. Writing keyboard responses and trial information to an output data file. Playing audio files (for startle). Triggering screen changes with subject responses vs defined durations. Experiment 2 Code: Monte Carlo This experiment is a three day memory reconsolidation study, including encoding, reactivation with reconsolidation, and retrieval. The goal is to see whether participants can use emotion regulation as a form of reconsolidation. The task itself appears in the form of paired associate learning, where participants are presented with pairs of images, reminded of one, and tested on their memory of the associated picture. This paradigm requires displaying images, cuing regulation strategies, reading in user button presses, and keeping track of old and new images for a memory test. The full set of scripts and stimuli can be found in ccn-keoki.win.duke.edu/experiments2/Natasha/EmoRegCon. In addition to most of the items covered in Experiment 1, this experiment covers: Using mouse clicks to advance screens (practice/training files). Displaying multiple images on a single screen (Session1.m). Online pseudo-randomization in a systematic manner (organizeStims.m) or using a Monte Carlo simulation (randomStimsMC.m, linked to above). Storage and usage of stimuli across multiple scripts (all Session files). Batch scripting (stimCreationBatch.m). BTP Demo Materials There are also a few simple demos that come with the PTB software download itself. On Windows, they are stored in C:\\\\toolbox\\Psychtoolbox\\PsychDemos\\PsychExampleExperiments, and on Mac they are in Applications/Psychtoobox/PsychDemos/PsychExampleExperiments. In fact, the PsychDemos folder has a lot of useful starting information, including demos of how to include video and audio, although sometimes they call functions that are a little dated. 4.2 Questions and Answers Q: Which version of Psychtoolbox should I install? A: The newest version of Psychtoolbox is 64-bit. If your (Windows) computer only supports 32-bit programs or you are planning to use your computer with BIOPAC, you will need to install the 32 bit version of Matlab and Psychtoolbox. This means that your psychtoolbox call will need to include a “flavor.” After downloading the DownloadPsychtoolbox script, open Matlab and use the command DownloadPsychtoolbox(‘Psychtoolbox-3.0.11’) for Windows. Q: I’m getting warnings about GStreamer when I open Matlab. What is the correct way to install this add-on? A: This was a common problem in the lab, and each person dealt with it differently. Here are things that worked for us: If you manually downloaded the 64-bit version from the folders located at gstreamer-org, make sure you downloaded all the files in the newest version, and the folder is located in the same place as your Program Files folder if using Windows (usually in your Local Disk). You may also need to run “SetupPsychtoolbox” or “startup” when you open Matlab. Another fix is to do the automatic download from GStreamer (look for the big green button partway down the page). This site also lets you differentiate between 32-bit and 64-bit versions. Q: I’ve installed the latest version of GStreamer but it causes Matlab to crash as soon as it tries to load a movie. What’s going on? Unfortunately, there seem to be some incompatibilities between the recent releases of GStreamer and some versions of Matlab on Windows. There is a very, very long discussion thread on Yahoo groups here (link broken, NM Jul 29 2022) between several people trying to debug this issue. The recent version of GStreamer (2013.6 Congo) has been verified in the lab to work with Matlab R2010a. It has also been verified to NOT work with R2013b. Some suggestions from the Yahoo thread include using the 32-bit version of GStreamer or using an earlier release of the 64-bit version. None of these have been tested locally. Q: How do you display multiple pictures on a single screen? A: Though PTB documentation suggests using Screen(‘DrawTextures’, …), this call seemed to create a memory error with 3 pictures. Instead, make separate Screen(‘DrawTexture’, …) calls for each picture, where you specify the window in which the picture can be drawn. For example, Screen(‘DrawTexture’, w, tex, [], [0 0 50 50]); will draw your entire picture that is stored in the texture “tex” in a 50x50 pixel square in the top left corner of the screen. Once you have drawn all the textures relating to the pictures you want to show on the single screen, use the flip command to display them all. For more information about the Screen command, see the Basics section and example code in Screen Function section. 4.3 Screen Function In this introduction to the Screen function, we provide some simple code with explanations to orient you to PTB’s structure. Here is an example of the functions mentioned above with supporting functions required to make a working program. [w, wRect] = Screen(&#39;OpenWindow&#39;, 0, BlackIndex(0)); Screen(&#39;TextSize&#39;, w, 32); Screen(&#39;TextFont&#39;, w, &#39;Helvetica&#39;); DrawFormattedText(w, &#39;Hi, there&#39;, &#39;center&#39;, &#39;center&#39;, WhiteIndex(w)); Screen(&#39;Flip&#39;, w); WaitSecs(2.0); DrawFormattedText(w, &#39;How are you?&#39;, &#39;center&#39;, &#39;center&#39;, GrayIndex(w)); Screen(&#39;Flip&#39;, w); WaitSecs(2.0); picture = imread(&#39;smiley.jpg&#39;); tex = Screen(&#39;MakeTexture&#39;, w, picture); Screen(&#39;DrawTexture&#39;, w, tex); Screen(&#39;Flip&#39;, w); WaitSecs(2.0); Screen(&#39;CloseAll&#39;); First, we initialize the double-buffered window we will use for presentation. 0 is the screen number (monitor/display) we want to use for presentation. On a Windows OS, 0 refers to all displays. BlackIndex() is defining the background color for our new window as the standard black value for screen number 0 on the current system. The initialized window is saved as an output (“w” here, referred to as a window pointer). The size of the full window is saved as a 4 component vector, stored in wRect here. Let’s say the vector looks like [0 0 1680 1050]. Each number represents the pixel x or y value of the window, specifically [left (x1), top (y1), right (x2), bottom (y2)]. In our example, (0, 0) would the be the coordinates of the top left corner, and (1680, 1050) would be the coordinates of the bottom right corner. Most of the time, you won’t need to use wRect at all, but we will give an example of where it can be used below. Next are a couple of commands to set the font and font size of text for our new window w. Then, the DrawFormattedText() command tells PTB to write the text ‘Hi, there’ in the vertical and horizontal center of the back buffer (automatically the back buffer) of w in white text. Note, the BlackIndex(), WhiteIndex(), and GrayIndex() functions will accept either a screen number (here is 0) or window pointer (here is w). As soon as the Screen(‘Flip’) command is executed, the screen with ‘Hi, there.’ becomes visible to the viewer. Then, we prepare another message for presentation, ‘How are you?’ in gray text. To keep this screen from replacing the first message after only a handful of milliseconds (the next monitor refresh), we threw in a WaitSecs() command to ensure ‘Hi, there’ is presented for 2 seconds before Screen(‘Flip’) replaces it with ‘How are you?’. Similarly, we show this message for 2 seconds before moving on to the next set of changes to the screen. After the text commands, we have commands that work in conjunction to display a picture on the screen. First, we load the image into a matrix that represents colors by pixel. This process is accomplished by imread(). Next, we prepare the image to be drawn onto the back buffer; think of the Screen(‘MakeTexture’) command as creating a stencil so that drawing the image on the dry erase board will take much less time. Lastly, the picture is drawn onto the back buffer using the Screen(‘DrawTexture’) function. The screen is flipped and the image is displayed for 2 seconds. The Screen(‘DrawTexture’) function can be run with many extra inputs to change the display settings of the picture. After w and the texture input, the fourth input to the function can be a vector specifying how much of the image to display. For example, if you only want to show the top left 50x50 pixel square of the image, you can put in [0 0 50 50] as the fourth input. Similarly, the fifth input specifies where on the screen you want to display the image. This is where wRect comes in useful. Say you only want to show the picture on the top half of the screen. You can input [0 0 wRect(3) wRect(4)/2], where the second y value is divided by 2, implying that this new rectangle only goes halfway down the screen. The last line in our example above is required to properly close the window and anything drawn on it. This call also quits PTB. Generally, you want to call Screen(‘CloseAll’) at the end of your script, but there is also a function called Screen(‘Close’). This call is useful if you have an excessive number of Screen commands in succession (like in a for loop for an event-based paradigm). Like marker residue on a dry erase board, it seems as though PTB doesn’t do a perfect job of erasing the back buffer before drawing the next item onto it. Thus, multiple Screen calls can create a buildup of memory, causing commands to slow down. Adding Screen(‘Close’) at the end of the for loop will properly close all previously drawn objects while keeping the front buffer intact. 4.4 Psychtoolboox use at BIAC Even if you are familiar with Psychtoolbox, getting it to work on the BIAC computers presents a few challenges. Here is a list of some of the things lab members have experienced so that we don’t have to reinvent the wheel every time. 4.4.1 Loading PTB If you try to run your tested PTB code on a BIAC computer without any changes, you will notice that simple PTB commands will fail. For example, AssertOpenGL or a simple OpenWindow using the Screen function may throw errors. It turns out that PTB needs to be set up every time you open MATLAB. You can either do this by navigating to the Psychtoolbox folder on Munin, or add the following two lines of code to your program. If you have many runs that use the same function call, you can also make this a conditional so it only sets up PTB on the first run. addpath(&#39;\\\\Munin\\Data\\Programs\\MATLAB\\PsychToolbox\\3.0.11&#39;); BIACSetupPsychtoolbox; 4.4.2 Triggering Experiment Start Various lab members have had a lot of trouble with this, especially because BIAC5 and BIAC6 seem to work differently. However, code provided to us by Chris Petty seems to work on both scanners. Near the top of your code, you need to make sure you can access and send information to the daq (data acquisition device. To do that, put in the following lines: try daq = DaqDeviceIndex(); catch error(&#39;Daq device not found&#39;); end Then, right before the start of your experiment, you can paste the following code. This will take the number that the counter is at (which counts the number of TTL pulses) and wait for another to be sent out before continuing. Note that there is a pulse per slice acquisition. curcount = DaqCIn(daq); while 1 if DaqCIn(daq) &gt; curcount % start your task break else pause(.05) % do short sleep here just so you’re not executing % the counter check a billion times end end 4.4.3 Recording Events Onset and Duration To do fMRI analysis, it is important to know the onset time and duration of each event that occurs in your task. There are a few easy ways to do this with PTB. Firstly, if you want to manually get the time whenever you want, you can use the command GetSecs; to retrieve the current computer time. You should do this near the beginning of your task and after your disdaqs to get a sense of your start time; this start time can be subtracted out of all other timing calls in the future to get a relative time (in terms of start of experiment/scan) instead of the absolute computer time. You can also use timing output from the command Screen(‘Flip’). There are three timing outputs from this command; the second is the one that is closest to stimulus presentation. So, using the code [~ onsetTime] = Screen('Flip'); will give you the time at which the stimulus shown on the next screen is displayed (in the same format as GetSecs, so the absolute computer time). You can use this to get specific onsets of stimulus presentations. Note that both of these will be in milliseconds, so divide the output by 1000 for seconds. Similarly, you can use either of these two methods to get durations – simply get the timing after an event goes away (using either method) and subtract the onset time to get the duration. Both onset and duration are important for fMRI analysis. 4.4.4 Using the Button Box If you’re using the button box(es) for responses in the scanner, it is useful to know that the buttons do not linearly increase from left to right. If you’re only using one box, specifically, the right one, you should be fine, but the problem comes when you try to use both. Here is the coding for the buttons, from left to right. Left hand: 9 8 7 6, Right hand: 1 2 3 4 Also, the buttons register as if they are the numbers on the top of the keyboard, so all of them will have a KbName of 1!, 2@, etc. Also, the button presses are extra sticky in the scanner. This isn’t a problem usually when you’re looking for a response in a certain time window, but it can be an issue if you have responses advancing your screens. Add in extra wait times after those. Other thing of note: the projected screen into the scanner is quite small, pixelwise, so try to leave extra space around your words/images when testing elsewhere. Hopefully that proved at least a little helpful! Good luck! "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
